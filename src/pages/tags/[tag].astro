---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ArticleCard from '../../components/ArticleCard.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  const tagSet = new Set<string>();
  articles.forEach((article) => {
    article.data.tags.forEach((tag: string) => tagSet.add(tag));
  });

  return [...tagSet].map((tag) => ({
    params: { tag },
    props: {
      tag,
      articles: articles
        .filter((a) => a.data.tags.includes(tag))
        .sort(
          (a, b) =>
            new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
        ),
    },
  }));
}

const { tag, articles } = Astro.props;
---

<BaseLayout
  title={`#${tag}`}
  description={`'${tag}' 태그가 포함된 글 목록입니다.`}
>
  <section>
    <h1 class="page-title">#{tag}</h1>
    <p class="count">{articles.length}개의 글</p>
    {articles.map((article: any) => (
      <ArticleCard
        title={article.data.title}
        date={article.data.date}
        description={article.data.description}
        tags={article.data.tags}
        slug={article.id}
      />
    ))}
  </section>
</BaseLayout>

<style>
  .page-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
  }
  .count {
    color: #9ca3af;
    font-size: 0.875rem;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #111827;
  }
</style>
